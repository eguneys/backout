var Tetris=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){n(2);const a=n(3);e.exports=a.app},function(e,t,n){},function(e,t,n){"use strict";n.r(t);const a={Play:"play",Over:"over"},r=3,i=Math.PI,s=2*i,o=s/3;function c(e,t){return Math.random()*(t-e)+e}function l(e){return e[(t=0,n=e.length,Math.floor(c(t,n)))];var t,n}function h(e,t,n){return Math.min(Math.max(e,t),n)}function d(){return Date.now()}const f=(e,t,n=1e3)=>{d()-e>n&&t()};var u=function(){var e,t,n,a,r,i=function(e){return Math.sin(6.283184*e)},s=function(e){return.003959503758*Math.pow(2,(e-128)/12)},o=function(e,t,n){var a,r,i,o,l,h,d,f=c[e.i[0]],u=e.i[1],p=e.i[3],g=c[e.i[4]],y=e.i[5],v=e.i[8],x=e.i[9],w=e.i[10]*e.i[10]*4,m=e.i[11]*e.i[11]*4,b=e.i[12]*e.i[12]*4,M=1/b,k=e.i[13],S=n*Math.pow(2,2-e.i[14]),T=new Int32Array(w+m+b),B=0,C=0;for(a=0,r=0;a<w+m+b;a++,r++)r>=0&&(r-=S,h=s(t+(15&(k=k>>8|(255&k)<<4))+e.i[2]-128),d=s(t+(15&k)+e.i[6]-128)*(1+8e-4*e.i[7])),i=1,a<w?i=a/w:a>=w+m&&(i-=(a-w-m)*M),o=h,p&&(o*=i*i),l=f(B+=o)*u,o=d,v&&(o*=i*i),l+=g(C+=o)*y,x&&(l+=(2*Math.random()-1)*x),T[a]=80*l*i|0;return T},c=[i,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return t<2?t-1:3-t}];this.init=function(i){e=i,t=i.endPattern,n=0,a=i.rowLen*i.patternLen*(t+1)*2,r=new Int32Array(a)},this.generate=function(){var s,l,h,d,f,u,p,g,y,v,x,w,m,b,M=new Int32Array(a),k=e.songData[n],S=e.rowLen,T=e.patternLen,B=0,C=0,A=!1,P=[];for(h=0;h<=t;++h)for(p=k.p[h],d=0;d<T;++d){var E=p?k.c[p-1].f[d]:0;E&&(k.i[E-1]=k.c[p-1].f[d+T]||0,E<16&&(P=[]));var O=c[k.i[15]],L=k.i[16]/512,D=Math.pow(2,k.i[17]-9)/S,K=k.i[18],U=k.i[19],j=43.23529*k.i[20]*3.141592/44100,R=1-k.i[21]/255,G=1e-5*k.i[22],I=k.i[23]/32,_=k.i[24]/512,F=6.283184*Math.pow(2,k.i[25]-9)/S,H=k.i[26]/255,W=k.i[27]*S&-2;for(x=(h*T+d)*S,f=0;f<4;++f)if(u=p?k.c[p-1].n[d+f*T]:0){P[u]||(P[u]=o(k,u,S));var V=P[u];for(l=0,s=2*x;l<V.length;l++,s+=2)M[s]+=V[l]}for(l=0;l<S;l++)(v=M[g=2*(x+l)])||A?(w=j,K&&(w*=O(D*g)*L+.5),C+=(w=1.5*Math.sin(w))*(m=R*(v-C)-(B+=w*C)),v=3==U?C:1==U?m:B,G&&(v=(v*=G)<1?v>-1?i(.25*v):-1:1,v/=G),A=(v*=I)*v>1e-5,b=v*(1-(y=Math.sin(F*g)*_+.5)),v*=y):b=0,g>=W&&(b+=M[g-W+1]*H,v+=M[g-W]*H),M[g]=0|b,M[g+1]=0|v,r[g]+=0|b,r[g+1]+=0|v}return++n/e.numChannels},this.createWave=function(){var e=44+2*a-8,t=e-36,n=new Uint8Array(44+2*a);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var i=0,s=44;i<a;++i){var o=r[i];o=o<-32767?-32767:o>32767?32767:o,n[s++]=255&o,n[s++]=o>>8&255}return n},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),a=new Array(t),i=0;i<2*t;i+=1){var s=n+i;a[i]=e>0&&s<r.length?r[s]/32768:0}return a}},p={songData:[{i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,194,4,1,3,25,191,115,244,147,6,84,6],p:[5,1,2,1,1,1,1,3,4,1,2,1,2,1,2,,,7,8,7,8,7,8,7,8,6,9],c:[{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,48]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,11,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,31]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,123],f:[]},{n:[114,,,,,,,,126,,,,,,,,114,,,,,,,,114,126,111,123,114,126,118,130],f:[13,,,,,,,,,,,,,,,,,,,,,,,,13,,13,,13,,13,11,29,,,,,,,,,,,,,,,,,,,,,,,,32,,41,,29,,25,15]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],f:[13,11,21,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,17,29,,25,113,,,,,,,,,,,,,,,,,,,,,,,,,,,,194]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,99],f:[]},{n:[111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111],f:[]},{n:[114,126,,126,114,,126,114,114,126,,126,114,,126,114,114,126,,126,114,,126,114,116,128,,128,116,,114,121],f:[]},{n:[],f:[]}]},{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,0,0,2,14,1,1,39,76,5,0,0],p:[,1,1,1,1,1,1,2,,,,1,1,1,1,1,1,,,1,1,1,1,1,1],c:[{n:[147,,,,,,147,,,,147,,,,,,147,,,,,,147,,,,147,,,,147],f:[]},{n:[147],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,60,4,10,68,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,1,1,2,3,2,3,4,,,,2,3,2,3,2,3,,,5,5,5,5,5,5,4],c:[{n:[,,,,147,,,,,,,,148,,,,,,,,147,,,,,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,147,147,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,68]},{n:[147,,,147,,,147,,147,,,147,,147,,147,147,,,147,,,147,,147,,,147,,147,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]}]},{i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,136,5,1,2,8,92,21,56,148,5,85,8],p:[3,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[111],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,56]}]},{i:[3,0,127,0,3,68,127,0,1,218,4,4,40,0,0,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,,,1,2,1,2,3,,,,1,2,1,2,1,2,,,1,4,1,4,1,4,3],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,147,147],f:[]},{n:[147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,147],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,67,0,0,0,0,0,0,2,255,15,0,32,83,3,134,4],p:[,,,1,2,3,2,1,2,,,1,2,3,2,1,2,,,,,4,5,4,5],c:[{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],f:[5,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,157,,162,,126],f:[]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],f:[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[159,,162,,164,,,,159,,162,164,,,162,,159,,162,,164,,,,159,,162,164,,,162],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[157,,162,,164,,,,157,,162,164,,,162,,157,,162,,164,,,,157,,162,164,,,162],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]}]},{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,3,179,5,1,3,37,135,63,67,150,3,157,6],p:[,,,,,,,,,1,2,3,,1,2,1,2,3,,4,5,,,,,3],c:[{n:[123,,,,,,,,,,,,,,,,130],f:[11,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,92,67]},{n:[133,,,,,,,,,,,,,,,138,126,,,,,,,,,,,,125],f:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,11,,,,95,,,,,,,,,,,,,,,,,,,,,,,,,,,,29]},{n:[123],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,52,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,116],f:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,95]},{n:[133,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,126,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,118],f:[]}]},{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,16,83,5,53,1],p:[,,,,,,,1,,,,,,,,,,1,,,,,,,,1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:26,numChannels:8},g={songData:[{i:[0,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,195,4,1,2,50,184,119,244,147,6,84,6],p:[5],c:[{n:[146,146,146,146,146,146,146,146,146,146,146],f:[5]},{n:[146,147],f:[]},{n:[152],f:[]},{n:[152,154,156,154,,147,146,158,142,158,140,156,139,146,140,142,144,146,142,147,142,151,152,152,156,152,154,154,154,154,154,146],f:[]},{n:[152],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},y={songData:[{i:[2,255,152,0,2,255,152,12,0,192,0,29,31,0,0,0,0,0,0,1,255,0,3,32,55,3,124,2],p:[2],c:[{n:[139,139,140,140,140,140,140,139,139,139,139,140,140,140,140,140,139,137,137,137,135,137,137,139,139,139,139,139,140,139,135,137],f:[]},{n:[139],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1};function v(e){let t=new AudioContext,n=t.createGain();n.connect(t.destination);const a={},r=(e,t)=>{a[e]=t},i=[{name:"song",data:p},{name:"sndSplode2",data:g},{name:"sndSplode3",data:y}];this.generate=()=>(i.forEach(e=>{let n=new u;n.init(e.data),function a(){if(1===n.generate()){let a=n.createWave().buffer;t.decodeAudioData(a,t=>{r(e.name,t)})}else setTimeout(a,0)}()}),new Promise(e=>{!function t(){Object.keys(a).length!==i.length?setTimeout(t,100):e()}()})),this.playSound=(e,r=1,i=0,s=.5,o=!1)=>{const c=a[e];if(!c)return null;let l=t.createBufferSource(),h=t.createGain(),d=t.createStereoPanner();return l.buffer=c,l.connect(d),d.connect(h),h.connect(n),l.playbackRate.value=r,l.loop=o,h.gain.value=s,d.pan.value=i,l.start(),{volume:h,sound:l}}}function x(e,t){const{width:n,height:a}=e.game,r=n*a;this.buffers={Screen:0,Effects:r,Buffer:2*r,Background:3*r,Midground:4*r,Foreground:5*r,Sprites:7*r,Ui:8*r,Collision:9*r};const i=this.buffers,s=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610,4278190080];let o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64];this.renderTarget=i.Screen,this.renderSource=i.Page1;const c=t.getImageData(0,0,n,a);let l=new ArrayBuffer(c.data.length),d=new Uint8ClampedArray(l),f=new Uint32Array(l),u=new Uint8ClampedArray(n*a*22);this.clear=e=>{u.fill(e,this.renderTarget,this.renderTarget+r)},this.pset=(e,t,r)=>{e=h(0|e,0,n),t=h(0|t,0,a),u[this.renderTarget+t*n+e]=r},this.pget=(e,t,r)=>(e=h(0|e,0,n),t=h(0|t,0,a),u[r+t*n+e]),this.spr=(e=0,t=0,r=n,i=a,s=0,c=0,l=!1,h=!1)=>{for(let d=0;d<i;d++)for(let i=0;i<r;i++)if(c+d<a&&s+i<n&&c+d>-1&&s+i>-1&&!l&!h){let a=this.renderTarget+((c+d)*n+s+i),r=this.renderSource+((t+d)*n+e+i);u[r]>0&&(u[a]=o[u[r]])}},this.rspr=(e,t,r,i,s,c,l,h)=>{let d=r/2|0,f=i/2|0,p=r/2*1.41421|5,g=i/2*1.41421|5,y=-p,v=p,x=-g,w=g,m=Math.cos(-h),b=Math.sin(-h);for(let l=x;l<w;l++)for(let h=y;h<v;h++){let p=d+Math.round(m*h+b*l),g=f+Math.round(-b*h+m*l),y=h+s|0,v=l+c|0;if(y>0&&y<n&&v>0&&v<a&&p>=0&&g>=0&&p<r&&g<i){let a=this.renderSource+(p+e)+(g+t)*n,r=this.renderTarget+y+v*n;u[a]>0&&(u[r]=o[u[a]])}}},this.line=(e,t,n,a,r)=>{let i,s=(a|=0)-(t|=0),o=(n|=0)-(e|=0),c=1,l=1;if(s<0&&(s=-s,l=-1),o<0&&(o=-o,c=-1),s<<=1,o<<=1,this.pset(e,t,r),o>s)for(i=s-(o>>1);e!=n;)i>=0&&(t+=l,i-=o),e+=c,i+=s,this.pset(e,t,r);else for(i=o-(s>>1);t!=a;)i>=0&&(e+=c,i-=s),t+=l,i+=o,this.pset(e,t,r)},this.circle=(e,t,n,a)=>{let r=-n,i=0,s=2-2*n;do{this.pset(e-r,t+i,a),this.pset(e-i,t-r,a),this.pset(e+r,t-i,a),this.pset(e+i,t+r,a),(n=s)<=i&&(s+=2*++i+1),(n>r||s>i)&&(s+=2*++r+1)}while(r<0)},this.fillCircle=(e,t,n,a)=>{if(n<0)return;e|=0,t|=0,a|=0;let r=-(n|=0),i=0,s=2-2*n;do{this.line(e-r,t-i,e+r,t-i,a),this.line(e-r,t+i,e+r,t+i,a),(n=s)<=i&&(s+=2*++i+1),(n>r||s>i)&&(s+=2*++r+1)}while(r<0)},this.fillRect=(e,t,n,a,r)=>{e|=0,t|=0,n|=0,a|=0;let i=Math.abs(a-t);if(this.line(e,t,n,t,r),i>0)for(;--i;)this.line(e,t+i,n,t+i,r);this.line(e,a,n,a,r)},this.fr=(e,t,n,a,r)=>{let i=0|e,s=0|t,o=e+n|0,c=t+a|0,l=Math.abs(c-s);if(this.line(i,s,o,s,r),l>0)for(;--l;)this.line(i,s+l,o,s+l,r);this.line(i,c,o,c,r)};this.render=()=>{let e=i.Effects;for(;e--;)f[e]=s[o[u[e]]];c.data.set(d),t.putImageData(c,0,0)}}const w=function(){const e={0:"\n.....\n.   .\n. . .\n.   .\n.....\n",1:"\n ..\n. .\n  .\n  .\n....\n",2:"\n ...\n.  .\n  .\n . \n....\n",3:"\n ...\n.  .\n  .\n   .\n....\n",4:"\n   .\n  ..\n . .\n.....\n   .\n   .\n",5:"\n....\n. \n....\n   .\n....\n",6:"\n.....\n.\n.....\n.   .\n.....\n",7:"\n.....\n    .\n    .\n    .\n    .\n",8:"\n.....\n.   .\n.....\n.   .\n.....\n",9:"\n.....\n.   .\n.....\n    .\n.....\n","-":"\n\n\n.....\n\n\n",".":"\n\n\n\n\n .\n"," ":"\n\n\n\n\n\n","/":"\n    .\n   .\n  .\n .\n.\n",a:"\n  .\n . .\n.   .\n.....\n.   .\n",b:"\n....\n.   .\n....\n.   .\n....\n",c:"\n  ...\n.\n.\n.\n ....\n",d:"\n....\n.   .\n.   .\n.   .\n....\n",e:"\n ....\n.\n....\n.\n.....\n",f:"\n ....\n.\n....\n.\n.\n",g:"\n.....\n.\n. ...\n.   .\n.....\n",h:"\n.   .\n.   .\n.....\n.   .\n.   .\n",k:"\n.  .\n. .\n..\n. .\n.  .\n",i:"\n.....\n  .\n  .\n  .\n.....\n",l:"\n.\n.\n.\n.\n.....\n",n:"\n.   .\n..  .\n. . .\n.  ..\n.   .\n",p:"\n....\n.   .\n....\n.\n.\n",r:"\n....\n.   .\n....\n.   .\n.   .\n",s:"\n ...\n.   \n ..\n   .\n...\n",t:"\n.....\n  .\n  .\n  .\n  .\n",u:"\n.   .\n.   .\n.   .\n.   .\n ...\n",v:"\n.   .\n.   .\n.   .\n . .\n  .\n",w:"\n.   .\n.   .\n. . .\n. . .\n . .\n",x:"\n.   .\n . .\n  .\n . .\n.   .\n",y:"\n.   .\n . .\n  .\n  .\n  .\n",unknown:"\n.....\n.   .\n.   .\n.   .\n.....\n"};return Object.keys(e).reduce((t,n)=>({[n]:e[n].replace(/^\n|\n$/g,"").split("\n").map(e=>e.split("")),...t}),{})}();function m(e,t){let n=e.text.length;for(let a=0;a<n;a++){let n=w[e.text.charAt(a)]||w.unknown;for(let r=0;r<5;r++)for(let i=0;i<5;i++)"."===n[r][i]&&(1===e.scale?t.pset(e.x+i+(5+e.hspacing)*a,e.y+r,e.color):t.fr(e.x+i*e.scale+(5*e.scale+e.hspacing)*a,e.y+r*e.scale,e.scale,e.scale,e.color))}}function b(e,t){let n=5*(e={scale:1,hspacing:2,vspacing:2,halign:"center",valign:"center",render:!0,...e}).scale,a=e.text.split("\n"),r=a.slice(0),i=a.length,s=r.sort((e,t)=>t.length-e.length)[0],o=s.length*n+(s.length-1)*e.hspacing,c=i*n+(i-1)*e.vspacing,l=e.x,h=e.y,d=e.x+o,f=e.y+c;"center"===e.halign&&(l=e.x-o/2,d=e.x+o/2),"center"===e.valign&&(h=e.y-c/2,f=e.y+c/2);let u=l+o/2,p=h+c/2;if(e.render)for(let r=0;r<i;r++){let i=a[r],s=i.length*n+(i.length-1)*e.hspacing,o=e.x,l=e.y+(n+e.vspacing)*r;"center"===e.halign&&(o=e.x-s/2),"center"===e.valign&&(l-=c/2),m({x:o,y:l,text:i,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color},t)}return{sx:l,sy:h,cx:u,cy:p,ex:d,ey:f,width:o,height:c}}function M(e,t){const{width:n,height:r}=e.data.game,i=t.buffers,s=e=>{const a=e.data.game.score+"";(e=>{const a=.01*e.data.game.tick,i=.6*n,s=.3*r,o=.008*i,c=n/2-i/2,l=.2*r-s/2;let h=Math.sin(a)*o;t.fr(c+3*o,l+3*o-Math.sin(a)*o,i,s,41),t.fr(c+h,l,i,s,50),b({x:n/2+h,y:.2*r,text:"backout",color:1,scale:5},t)})(e);let i,s=.1*r;i=b({x:n/2,y:.45*r,text:"high score "+a,color:12,scale:3,render:e.data.gameover},t),i=b({x:n/2,y:i.ey+s,text:"press space to play.",color:5,scale:2},t),b({x:n/2,y:i.ey+2*s,text:"avoid paddles to hit the ball.\nuse arrow keys to control paddles.\nuse space to go faster.",vspacing:8,color:7,scale:1.8},t)};this.render=e=>{t.renderTarget=i.Ui,e.data.state===a.Over&&s(e)}}function k(e,t){const{tileWidth:n,tileHeight:a,width:r,height:i}=e.data.game,s=t.buffers;this.render=e=>{(e=e.play).spots.each(e=>(function(e,t,n){n.renderTarget=s.Buffer;const{x:a,y:r,radius:i,color:o}=t.data;n.fillCircle(a,r,i,o),n.fillCircle(a,r,.6*i,o+1)})(0,e,t)),function(e,t){t.renderTarget=s.Background;let o=r/n,c=i/a;for(let e=0;e<o;e++)for(let r=0;r<c;r++){let i,o;i=e*n,o=r*a;let c=t.pget(i,o,s.Buffer);t.fr(i,o,n,a,c)}}(0,t),function(e,t){const n=e.data.hero.edge,a="left"===n?38:41,o="right"===n?38:41,c="up"===n?38:41,l="down"===n?38:41;t.renderTarget=s.Collision,t.fr(0,0,r,1,c),t.fr(0,0,1,i,a),t.fr(0,i-1,r,1,l),t.fr(r-1,0,1,i,o)}(e,t),e.data.paddles.forEach(e=>(function(e,t,n){n.renderTarget=s.Collision;const{x:a,y:o,w:c,h:l,side:h}=t,{vx:d,vy:f}=t,u=1===d||1===f?12:15;let p=0,g=0;switch(h){case"left":p=.08*l,g=.03*(i/2-o);break;case"right":p=.08*-l,g=.03*(i/2-o);break;case"up":g=.08*c,p=.01*(r/2-a);break;case"down":g=.08*-c,p=.01*(r/2-a)}n.fr(a+p,o+g,c,l,16),n.fr(a+p,o+g,c,l,16),n.fr(a,o,c,l,u)})(0,e,t)),e.blocks.each(e=>(function(e,t){t.renderTarget=s.Collision;const{x:n,y:a,angle:r,length:i,color:o}=e.data;let c=Math.cos(r)*i,l=Math.sin(r)*i;t.line(n,a,n+c,a+l,o)})(e,t)),function(e,t){t.renderTarget=s.Collision;const{vx:n,vy:a,x:r,y:i,radius:o,rotation:c,color:l,active:h,tick:d}=e.data.hero;t.fillCircle(r,i,o,l),t.renderTarget=s.Midground;const f=Math.cos(c),u=Math.sin(c),p=[40,5,4,3,2],g=p[Math.floor(h)%p.length];t.fillCircle(r-.5*n,i-.5*a,o,43),t.fillCircle(r,i,o,g),t.fillCircle(r-f,i-u,.5*o,41)}(e,t),function(e,t){const n=e.data.game.score+"",a=b({x:.1*r,y:10,text:"score",color:48,scale:1},t);b({x:a.ex+20,y:10,text:n,color:48,scale:1},t)}(e,t)}}function S(e,t){const{width:n,height:a}=e.data.game,r=t.buffers;t.renderTarget=r.Screen;const i=new M(e,t),s=new k(e,t);this.render=e=>{!function(e,t){t.renderTarget=r.Ui,t.clear(0),t.renderTarget=r.Collision,t.clear(0),t.renderTarget=r.Background,t.clear(0),t.renderTarget=r.Buffer,t.clear(0),t.renderTarget=r.Screen,t.clear(0),t.renderTarget=r.Midground,t.clear(0),t.renderTarget=r.Foreground,t.clear(0)}(0,t),s.render(e),i.render(e),function(e,t){if(!e.data.debug)return;t.renderTarget=r.Foreground;for(let e=0;e<64;e++){const a=8*Math.floor(e/32)*4+.1*n,r=e%32*8;t.fillRect(a,r,a+8,r+8,e),b({x:a-8,y:r,hspacing:1,text:e+"",color:e},t)}}(e,t),function(e,t){t.renderSource=r.Background,t.renderTarget=r.Screen,t.spr(),t.renderSource=r.Collision,t.renderTarget=r.Screen,t.spr(),t.renderSource=r.Ui,t.renderTarget=r.Screen,t.spr(),t.renderSource=r.Midground,t.renderTarget=r.Screen,t.spr(),t.renderSource=r.Foreground,t.renderTarget=r.Screen,t.spr()}(0,t)}}function T(e,t){this.alive=[],this.dead=[],this.create=n=>{if(this.dead.length>0){let e=this.dead.pop();return e.init(n),this.alive.push(e),e}{let a=new e(t);return a.init(n),this.alive.push(a),a}},this.release=e=>{let t=this.alive.indexOf(e);t>-1&&this.dead.push(this.alive.splice(t,1)[0])},this.each=e=>{this.alive.forEach(e)},this.find=e=>this.alive.find(e)}function B(e,{g:t,a:n}){const{width:a,height:r}=e.data.game,i=e.data.hero,{radius:o}=i;this.update=t=>{(e=>{i.vx+=i.ax*e*.001*i.boost,i.vy+=i.ay*e*.001*i.boost,i.x+=i.vx,i.y+=i.vy,i.x<o&&(i.x=o,i.vx*=-.5,i.ax*=-1,i.edge="left",i.active=4,i.audioEdge=!0),i.y<o&&(i.y=o,i.vy*=-.5,i.ay*=-1,i.edge="up",i.active=4,i.audioEdge=!0),i.x>=a-o&&(i.x=a-o,i.vx*=-.5,i.ax*=-1,i.edge="right",i.active=4,i.audioEdge=!0),i.y>=r-o&&(i.y=r-o,i.vy*=-.5,i.ay*=-1,i.edge="down",i.active=4,i.audioEdge=!0)})(t),(e=>{i.rotation+=i.active,i.rotation=i.rotation%s})(),(e=>{4===i.active&&(i.audioEdge?(i.audioEdge=!1,n.playSound("sndSplode2")):n.playSound("sndSplode3"))})(),(e=>{i.tick+=e,i.active>0&&(i.active=Math.max(0,i.active-e/16*.2))})(t),(t=>{e.spots.create({x:i.x-10*i.ax,y:i.y-10*i.ay,color:38,life:2})})(),(t=>{e.data.game.score+=Math.floor(i.active)})()},this.boost=e=>{i.boost=e},this.changeV=e=>{const t=[Math.cos(e),Math.sin(e)],n=[-i.vx,-i.vy],a=[n[0]+t[0],n[1]+t[1]];i.vx=h(2*a[0],-1,1),i.vy=h(2*a[1],-1,1),i.ax=h(2*a[0],-1,1),i.ay=h(2*a[1],-1,1),i.active=4}}function C(e,t,n){return n((n,a)=>e.pget(n,a,e.buffers.Collision)===t)}function A({x:e,y:t,w:n,h:a}){return r=>{for(let i=0;i<n;i+=1)for(let n=0;n<a;n+=1){if(r(e+i,t+n))return{x:i,y:n}}return null}}function P(e,t){const{width:n,height:a}=e.data.game,i=e.data.paddles;this.update=s=>{(e=>{i.map(e=>({e:e,c:C(t,r,A(e))})).find(e=>!!e.c)})(),i.forEach(t=>(t=>r=>{t.x+=t.vx*e.data.paddleBoost[0],t.y+=t.vy*e.data.paddleBoost[1],t.x>n-t.w&&(t.x=n-t.w,t.vx*=-1),t.x<0&&(t.x=0,t.vx*=-1),t.y>a-t.h&&(t.y=a-t.h,t.vy*=-1),t.y<0&&(t.y=0,t.vy*=-1)})(t)(s))}}function E(e){this.init=e=>{this.data={...t(),...e},this.data.radius=2*this.data.life},this.update=t=>{this.data.life-=.01*t,this.data.radius=2*this.data.life,this.data.life<0&&e.spots.release(this)};const t=()=>({x:0,y:0,color:12,life:10})}function O(e,t){const{g:n,a:i}=t;this.data=e;const{width:o,height:l}=this.data.game;this.hero=new B(this,t),this.paddles=new P(this,n),this.blocks=new T(L,this),this.spots=new T(E,this);const h=e=>{const t=this.blocks.find(e=>!(e.life<100)&&C(n,r,function({x:e,y:t,angle:n,length:a}){return r=>{for(let i=0;i<a;i+=.1){const a=Math.cos(n)*i,s=Math.sin(n)*i;let o=e+a,c=t+s;if(r(o,c))return{x:o,y:c}}return null}}(e.data)));t&&p(t)},u=()=>c(2,5),p=e=>{const{x:t,y:n,angle:a,color:r}=e.data;this.hero.changeV(a),this.blocks.release(e),this.spots.create({x:t,y:n,color:r}),c(0,1)<.5&&this.spots.create({x:t+20,y:n,life:u(),color:r}),c(0,1)<.5&&this.spots.create({x:t-20,y:n,life:u(),color:r}),c(0,1)<.5&&this.spots.create({x:t+20,y:n+20,life:u(),color:r}),c(0,1)<.5&&this.spots.create({x:t+20,y:n-20,life:u(),color:r}),c(0,1)<.5&&this.spots.create({x:t,y:n+20,life:u(),color:r}),c(0,1)<.5&&this.spots.create({x:t,y:n-20,life:u(),color:r})},g=()=>{this.userBoost?(this.hero.boost(20),f(this.userBoost,()=>{this.userBoost=0},100)):this.hero.boost(1)},y=K(()=>{const e=this.data.game.unit;this.blocks.create({x:c(e,o-e),y:c(e,l-e),length:.4*e,angle:c(0,s/4-s/8)+s/10})},1e3);this.reset=()=>{this.data.hero.x=o/2,this.data.hero.y=l/2,this.data.game.score=0},this.boost=()=>{this.userBoost=d()},this.paddleHit=()=>{this.data.gameover=d(),this.data.state=a.Over},this.paddleMove=e=>{0!==e[0]&&(this.data.paddleBoost[0]=e[0]),0!==e[1]&&(this.data.paddleBoost[1]=e[1])},this.update=e=>{g(),y(e),h(),this.hero.update(e),this.paddles.update(e),this.blocks.each(t=>t.update(e)),this.spots.each(t=>t.update(e))}}function L(e){this.init=e=>{this.data={...t(),...e},this.life=0},this.update=e=>{this.life+=e};const t=()=>({x:0,y:0,angle:o,length:100,color:D()})}const D=()=>l([11,21,54,42,29,18]),K=(e,t,n)=>{let a=0;return r=>{(a+=r)>=t?(e(),a=0):n&&n(a/t)}};function U(e,t){const{g:n}=t;this.data=e,this.update=e=>{}}function j(e,t){const{g:n,a:r}=t;this.data=e,this.play=new O(e,t),this.over=new U(e,t);const i=e=>{this.data.state===a.Play&&this.play.update(e),this.shouldResetGame&&(this.shouldResetGame=!1,this.play.reset(),this.data.gameover=0,this.data.state=a.Play)},s=e=>{this.data.state===a.Over&&this.over.update(e)};this.spaceHit=()=>{this.data.state===a.Play?this.play.boost():this.data.gameover?f(this.data.gameover,()=>{this.shouldResetGame=!0}):this.shouldResetGame=!0};this.pressKey=e=>{switch(e){case"up":this.play.paddleMove([0,-3]);break;case"down":this.play.paddleMove([0,3]);break;case"left":this.play.paddleMove([-3,0]);break;case"right":this.play.paddleMove([3,0])}},this.releaseKey=e=>{switch(e){case"up":this.data.paddleBoost[1]<0&&this.play.paddleMove([0,1]);break;case"down":this.data.paddleBoost[1]>0&&this.play.paddleMove([0,1]);break;case"left":this.data.paddleBoost[0]<0&&this.play.paddleMove([1,0]);break;case"right":this.data.paddleBoost[0]>0&&this.play.paddleMove([1,0])}},this.update=e=>{i(e),s(e),this.data.game.tick+=e}}const R=void 0!==window.performance?window.performance:Date,G=()=>R.now(),I=window.requestAnimationFrame;function _(e){let t=!1,n=G(),a=0;this.start=()=>t?this:(t=!0,n=G(),a=I(r),this),this.stop=()=>(t=!1,0!=a&&I.cancel(a),a=0,this);const r=()=>{a=I(r);const t=G();e(t-n),n=t}}function F(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function H(e,t){const n=document.createElement("canvas"),i=n.getContext("2d"),s={debug:!1,state:a.Over,game:{score:0,unit:40,tileWidth:3.84,tileHeight:2.56,width:384,height:256,ratio:256/384,vx:10,tick:0},paddleBoost:[1,1],paddles:[{side:"up",vx:1,vy:0,x:192,y:1,w:40,h:10},{side:"down",vx:-1,vy:0,x:192,y:245,w:40,h:10},{side:"left",vx:0,vy:1,x:1,y:128,w:10,h:40},{side:"right",vx:0,vy:-1,x:373,y:128,w:10,h:40}],hero:{color:r,radius:5,gap:2,gapMove:2,rotation:0,x:192,y:128,ax:-1,ay:-1,vx:0,vy:0,rotation:0,boost:1,tick:0,active:0}};let o=new v(s);o.generate().then(()=>{o.playSound("song",1,0,1,!0)});let c=new x(s,i),l=new j(s,{g:c,a:o}),h=new S(l,c);new _(e=>{l.update(e),h.render(l),c.render()}).start(),n.width=s.game.width,n.height=s.game.height,e.append(n),function(e){const t=[],n=function(e){return function(t){switch(t.code){case"Space":e.spaceHit();break;case"ArrowUp":e.pressKey("up");break;case"ArrowDown":e.pressKey("down");break;case"ArrowLeft":e.pressKey("left");break;case"ArrowRight":e.pressKey("right");break;default:return}t.preventDefault()}}(e),a=function(e){return function(t){switch(t.code){case"ArrowUp":e.releaseKey("up");break;case"ArrowDown":e.releaseKey("down");break;case"ArrowLeft":e.releaseKey("left");break;case"ArrowRight":e.releaseKey("right")}}}(e);t.push(F(document,"keydown",n)),t.push(F(document,"keyup",a))}(l)}n.d(t,"app",function(){return H})}]);