var Tetris=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){n(2);const r=n(3);e.exports=r.app},function(e,t,n){},function(e,t,n){"use strict";n.r(t);const r={Play:"play",Over:"over"},a=3,i=4,s=Math.PI,o=2*s,c=o/3;function l(e,t){return Math.random()*(t-e)+e}function h(e,t,n){return Math.min(Math.max(e,t),n)}function d(){return Date.now()}const u=(e,t,n=1e3)=>{d()-e>n&&t()};function f(e,t){const{width:n,height:r}=e.game,a=n*r;this.buffers={Screen:0,Effects:a,Buffer:2*a,Background:3*a,Midground:4*a,Foreground:5*a,Sprites:7*a,Ui:8*a,Collision:9*a};const i=this.buffers,s=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610,4278190080];let o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64];this.renderTarget=i.Screen,this.renderSource=i.Page1;const c=t.getImageData(0,0,n,r);let l=new ArrayBuffer(c.data.length),d=new Uint8ClampedArray(l),u=new Uint32Array(l),f=new Uint8ClampedArray(n*r*22);this.clear=e=>{f.fill(e,this.renderTarget,this.renderTarget+a)},this.pset=(e,t,a)=>{e=h(0|e,0,n),t=h(0|t,0,r),f[this.renderTarget+t*n+e]=a},this.pget=(e,t,a)=>(e=h(0|e,0,n),t=h(0|t,0,r),f[a+t*n+e]),this.spr=(e=0,t=0,a=n,i=r,s=0,c=0,l=!1,h=!1)=>{for(let d=0;d<i;d++)for(let i=0;i<a;i++)if(c+d<r&&s+i<n&&c+d>-1&&s+i>-1&&!l&!h){let r=this.renderTarget+((c+d)*n+s+i),a=this.renderSource+((t+d)*n+e+i);f[a]>0&&(f[r]=o[f[a]])}},this.line=(e,t,n,r,a)=>{let i,s=(r|=0)-(t|=0),o=(n|=0)-(e|=0),c=1,l=1;if(s<0&&(s=-s,l=-1),o<0&&(o=-o,c=-1),s<<=1,o<<=1,this.pset(e,t,a),o>s)for(i=s-(o>>1);e!=n;)i>=0&&(t+=l,i-=o),e+=c,i+=s,this.pset(e,t,a);else for(i=o-(s>>1);t!=r;)i>=0&&(e+=c,i-=s),t+=l,i+=o,this.pset(e,t,a)},this.circle=(e,t,n,r)=>{let a=-n,i=0,s=2-2*n;do{this.pset(e-a,t+i,r),this.pset(e-i,t-a,r),this.pset(e+a,t-i,r),this.pset(e+i,t+a,r),(n=s)<=i&&(s+=2*++i+1),(n>a||s>i)&&(s+=2*++a+1)}while(a<0)},this.fillCircle=(e,t,n,r)=>{if(n<0)return;e|=0,t|=0,r|=0;let a=-(n|=0),i=0,s=2-2*n;do{this.line(e-a,t-i,e+a,t-i,r),this.line(e-a,t+i,e+a,t+i,r),(n=s)<=i&&(s+=2*++i+1),(n>a||s>i)&&(s+=2*++a+1)}while(a<0)},this.fillRect=(e,t,n,r,a)=>{let i=Math.abs(r-t);if(this.line(e,t,n,t,a),i>0)for(;--i;)this.line(e,t+i,n,t+i,a);this.line(e,r,n,r,a)},this.fr=(e,t,n,r,a)=>{let i=0|e,s=0|t,o=e+n|0,c=t+r|0,l=Math.abs(c-s);if(this.line(i,s,o,s,a),l>0)for(;--l;)this.line(i,s+l,o,s+l,a);this.line(i,c,o,c,a)};this.render=()=>{let e=i.Effects;for(;e--;)u[e]=s[o[f[e]]];c.data.set(d),t.putImageData(c,0,0)}}const p=function(){const e={0:"\n.....\n.   .\n. . .\n.   .\n.....\n",1:"\n ..\n. .\n  .\n  .\n....\n",2:"\n ...\n.  .\n  .\n . \n....\n",3:"\n ...\n.  .\n  .\n   .\n....\n",4:"\n   .\n  ..\n . .\n.....\n   .\n   .\n",5:"\n....\n. \n....\n   .\n....\n",6:"\n.....\n.\n.....\n.   .\n.....\n",7:"\n.....\n    .\n    .\n    .\n    .\n",8:"\n.....\n.   .\n.....\n.   .\n.....\n",9:"\n.....\n.   .\n.....\n    .\n.....\n","-":"\n\n\n.....\n\n\n",".":"\n\n\n\n\n .\n"," ":"\n\n\n\n\n\n","/":"\n    .\n   .\n  .\n .\n.\n",a:"\n  .\n . .\n.   .\n.....\n.   .\n",b:"\n....\n.   .\n....\n.   .\n....\n",c:"\n  ...\n.\n.\n.\n ....\n",d:"\n....\n.   .\n.   .\n.   .\n....\n",e:"\n ....\n.\n....\n.\n.....\n",f:"\n ....\n.\n....\n.\n.\n",g:"\n.....\n.\n. ...\n.   .\n.....\n",h:"\n.   .\n.   .\n.....\n.   .\n.   .\n",k:"\n.  .\n. .\n..\n. .\n.  .\n",i:"\n.....\n  .\n  .\n  .\n.....\n",l:"\n.\n.\n.\n.\n.....\n",n:"\n.   .\n..  .\n. . .\n.  ..\n.   .\n",p:"\n....\n.   .\n....\n.\n.\n",r:"\n....\n.   .\n....\n.   .\n.   .\n",s:"\n ...\n.   \n ..\n   .\n...\n",t:"\n.....\n  .\n  .\n  .\n  .\n",u:"\n.   .\n.   .\n.   .\n.   .\n ...\n",v:"\n.   .\n.   .\n.   .\n . .\n  .\n",w:"\n.   .\n.   .\n. . .\n. . .\n . .\n",x:"\n.   .\n . .\n  .\n . .\n.   .\n",y:"\n.   .\n . .\n  .\n  .\n  .\n",unknown:"\n.....\n.   .\n.   .\n.   .\n.....\n"};return Object.keys(e).reduce((t,n)=>({[n]:e[n].replace(/^\n|\n$/g,"").split("\n").map(e=>e.split("")),...t}),{})}();function g(e,t){let n=e.text.length;for(let r=0;r<n;r++){let n=p[e.text.charAt(r)]||p.unknown;for(let a=0;a<5;a++)for(let i=0;i<5;i++)"."===n[a][i]&&(1===e.scale?t.pset(e.x+i+(5+e.hspacing)*r,e.y+a,e.color):t.fr(e.x+i*e.scale+(5*e.scale+e.hspacing)*r,e.y+a*e.scale,e.scale,e.scale,e.color))}}function y(e,t){let n=5*(e={scale:1,hspacing:2,vspacing:2,halign:"center",valign:"center",render:!0,...e}).scale,r=e.text.split("\n"),a=r.slice(0),i=r.length,s=a.sort((e,t)=>t.length-e.length)[0],o=s.length*n+(s.length-1)*e.hspacing,c=i*n+(i-1)*e.vspacing,l=e.x,h=e.y,d=e.x+o,u=e.y+c;"center"===e.halign&&(l=e.x-o/2,d=e.x+o/2),"center"===e.valign&&(h=e.y-c/2,u=e.y+c/2);let f=l+o/2,p=h+c/2;if(e.render)for(let a=0;a<i;a++){let i=r[a],s=i.length*n+(i.length-1)*e.hspacing,o=e.x,l=e.y+(n+e.vspacing)*a;"center"===e.halign&&(o=e.x-s/2),"center"===e.valign&&(l-=c/2),g({x:o,y:l,text:i,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color},t)}return{sx:l,sy:h,cx:f,cy:p,ex:d,ey:u,width:o,height:c}}function v(e,t){const{width:n,height:a}=e.data.game,i=t.buffers;this.render=e=>{t.renderTarget=i.Ui,e.data.state===r.Over&&(e=>{const r=e.data.game.score+"";y({x:n/2,y:.2*a,text:"backout",color:1,scale:5},t),e.data.gameover&&y({x:n/2,y:.4*a,text:"high score "+r,color:12,scale:3},t),y({x:n/2,y:.5*a,text:"press space to play.",color:5,scale:2},t),y({x:n/2,y:.7*a,text:"avoid paddles to hit the ball.\nuse arrow keys to control paddles.\nuse space to go faster.",vspacing:8,color:7,scale:1.8},t)})(e)}}function x(e,t){const{width:n,height:r}=e.data.game,a=t.buffers;t.renderTarget=a.Screen;const i=new v(e,t);this.render=e=>{!function(e,t){t.renderTarget=a.Ui,t.clear(0),t.renderTarget=a.Collision,t.clear(0),t.renderTarget=a.Screen,t.clear(0),t.renderTarget=a.Midground,t.clear(0)}(0,t),function(e,t){(function(e,t){const i=e.data.hero.edge,s="left"===i?38:41,o="right"===i?38:41,c="up"===i?38:41,l="down"===i?38:41;t.renderTarget=a.Screen,t.line(0,0,n,0,c),t.line(0,0,0,r,s),t.line(0,r-1,n,r-1,l),t.line(n-1,0,n-1,r,o)})(e=e.play,t),e.data.paddles.forEach(e=>(function(e,t,n){n.renderTarget=a.Collision;const{x:r,y:i,w:s,h:o}=t,{vx:c,vy:l}=t;n.fillRect(r,i,r+s,i+o,15),1===c&&n.fillRect(r,i,r+s,i+o,12);1===l&&n.fillRect(r,i,r+s,i+o,12)})(0,e,t)),e.blocks.each(e=>(function(e,t){t.renderTarget=a.Collision;const{x:n,y:r,angle:i,length:s,color:o}=e.data;let c=Math.cos(i)*s,l=Math.sin(i)*s;t.line(n,r,n+c,r+l,o)})(e,t)),function(e,t){t.renderTarget=a.Collision;const{vx:n,vy:r,x:i,y:s,radius:o,color:c,active:l}=e.data.hero;t.fillCircle(i,s,o,c),t.renderTarget=a.Midground;const h=[42,41,40,39,38],d=h[Math.floor(l)%h.length];t.fillCircle(i,s,o,d)}(e,t),function(e,t){const r=e.data.game.score+"",a=y({x:.1*n,y:10,text:"score",color:48,scale:1},t);y({x:a.ex+20,y:10,text:r,color:48,scale:1},t)}(e,t)}(e,t),i.render(e),function(e,t){t.renderTarget=a.Foreground;for(let e=0;e<64;e++){const r=8*Math.floor(e/32)*4+.2*n,a=e%32*8;t.fillRect(r,a,r+8,a+8,e),y({x:r-8,y:a,hspacing:1,text:e+"",color:e},t)}}(0,t),function(e,t){t.renderSource=a.Collision,t.renderTarget=a.Screen,t.spr(),t.renderSource=a.Ui,t.renderTarget=a.Screen,t.spr(),t.renderSource=a.Midground,t.renderTarget=a.Screen,t.spr(),t.renderSource=a.Foreground,t.renderTarget=a.Screen,t.spr()}(0,t)}}function w(e,t){this.alive=[],this.dead=[],this.create=n=>{if(this.dead.length>0){let e=this.dead.pop();return e.init(n),this.alive.push(e),e}{let r=new e(t);return r.init(n),this.alive.push(r),r}},this.release=e=>{let t=this.alive.indexOf(e);t>-1&&this.dead.push(this.alive.splice(t,1)[0])},this.each=e=>{this.alive.forEach(e)},this.find=e=>this.alive.find(e)}function b(e){const{width:t,height:n}=e.data.game,r=e.data.hero;this.update=e=>{(e=>{r.vx+=r.ax*e*.001,r.vy+=r.ay*e*.001,r.x+=r.vx,r.y+=r.vy,r.x<0&&(r.x=0,r.vx*=-.5,r.ax*=-1,r.edge="left",r.active=4),r.y<0&&(r.y=0,r.vy*=-.5,r.ay*=-1,r.edge="up",r.active=4),r.x>=t&&(r.x=t,r.vx*=-.5,r.ax*=-1,r.edge="right",r.active=4),r.y>=n&&(r.y=n,r.vy*=-.5,r.ay*=-1,r.edge="down",r.active=4)})(e),(e=>{r.tick+=e,r.active>0&&(r.active=Math.max(0,r.active-e/16*.2))})(e)},this.boost=e=>{r.boost=e},this.changeV=e=>{const t=[Math.cos(e),Math.sin(e)],n=[-r.vx,-r.vy],a=[n[0]+t[0],n[1]+t[1]];r.vx=h(2*a[0],-1,1),r.vy=h(2*a[1],-1,1),r.ax=h(2*a[0],-1,1),r.ay=h(2*a[1],-1,1),r.active=4}}function m(e,t,n){return n((n,r)=>e.pget(n,r,e.buffers.Collision)===t)}function M(e,t){const{width:n,height:r}=e.data.game,i=e.data.paddles;this.update=s=>{(e=>{i.find(e=>m(t,a,function({x:e,y:t,w:n,h:r}){return a=>{for(let i=0;i<n;i+=1)for(let n=0;n<r;n+=1)if(a(e+i,t+n))return!0;return!1}}(e)))})(),i.forEach(t=>(t=>a=>{t.x+=t.vx*e.data.paddleBoost[0],t.y+=t.vy*e.data.paddleBoost[1],t.x>n-t.w&&(t.x=n-t.w,t.vx*=-1),t.x<0&&(t.x=0,t.vx*=-1),t.y>r-t.h&&(t.y=r-t.h,t.vy*=-1),t.y<0&&(t.y=0,t.vy*=-1)})(t)(s))}}function k(e,t){this.data=e;const{width:n,height:i}=this.data.game;this.hero=new b(this),this.paddles=new M(this,t),this.blocks=new w(T,this);const s=e=>{const n=this.blocks.find(e=>!(e.life<100)&&m(t,a,function({x:e,y:t,angle:n,length:r}){return a=>{for(let i=0;i<r;i+=.1){const r=Math.cos(n)*i,s=Math.sin(n)*i;if(a(e+r,t+s))return!0}return!1}}(e.data)));n&&c(n)},c=e=>{const{angle:t}=e.data;this.hero.changeV(t),this.blocks.release(e),this.data.game.score++},h=()=>{this.userBoost?(this.hero.boost(10),this.userBoost=!1):this.hero.boost(1)},u=S(()=>{this.blocks.create({x:l(10,n-10),y:l(10,i-10),length:10,angle:l(0,o/4-o/8)+o/10})},1e3);this.reset=()=>{this.data.hero.x=n/2,this.data.hero.y=i/2,this.data.game.score=0},this.boost=()=>{this.userBoost=!0},this.paddleHit=()=>{this.data.gameover=d(),this.data.state=r.Over},this.paddleMove=e=>{console.log(e),0===e[0]?this.data.paddleBoost[0]=1:this.data.paddleBoost[0]=2*e[0],0===e[1]?this.data.paddleBoost[1]=1:this.data.paddleBoost[1]=2*e[1]},this.update=e=>{h(),u(e),s(),this.hero.update(e),this.paddles.update(e),this.blocks.each(t=>t.update(e))}}function T(e){this.init=e=>{this.data={...t(),...e},this.life=0},this.update=e=>{this.life+=e};const t=()=>({x:0,y:0,angle:c,length:100,color:i})}const S=(e,t,n)=>{let r=0;return a=>{(r+=a)>=t?(e(),r=0):n&&n(r/t)}};function O(e,t){this.data=e,this.update=e=>{}}function B(e,t){this.data=e,this.play=new k(e,t),this.over=new O(e,t);const n=e=>{this.data.state===r.Play&&this.play.update(e),this.shouldResetGame&&(this.shouldResetGame=!1,this.play.reset(),this.data.gameover=0,this.data.state=r.Play)},a=e=>{this.data.state===r.Over&&this.over.update(e)};this.spaceHit=()=>{this.data.state===r.Play?this.play.boost():this.data.gameover?u(this.data.gameover,()=>{this.shouldResetGame=!0}):this.shouldResetGame=!0},this.pressKey=e=>{switch(e){case"up":this.play.paddleMove([0,-1]);break;case"down":this.play.paddleMove([0,1]);break;case"left":this.play.paddleMove([-1,0]);break;case"right":this.play.paddleMove([1,0])}},this.update=e=>{n(e),a(e)}}const C=void 0!==window.performance?window.performance:Date,P=()=>C.now(),A=window.requestAnimationFrame;function R(e){let t=!1,n=P(),r=0;this.start=()=>t?this:(t=!0,n=P(),r=A(a),this),this.stop=()=>(t=!1,0!=r&&A.cancel(r),r=0,this);const a=()=>{r=A(a);const t=P();e(t-n),n=t}}function j(e,t){const n=document.createElement("canvas"),i=n.getContext("2d"),s={debug:!0,state:r.Over,game:{score:0,unit:40,width:384,height:256,ratio:256/384,vx:10,tick:0},paddleBoost:[1,1],paddles:[{vx:1,vy:0,x:192,y:1,w:40,h:10},{vx:-1,vy:0,x:192,y:245,w:40,h:10},{vx:0,vy:1,x:1,y:128,w:10,h:40},{vx:0,vy:-1,x:373,y:128,w:10,h:40}],hero:{color:a,radius:10,gap:2,gapMove:2,rotation:0,x:192,y:128,ax:0,ay:-1,vx:0,vy:0,boost:1,tick:0,active:0}};let o=new f(s,i),c=new B(s,o),l=new x(c,o);new R(e=>{c.update(e),l.render(c),o.render()}).start(),n.width=s.game.width,n.height=s.game.height,e.append(n),function(e){const t=[],n=function(e){return function(t){switch(t.code){case"Space":e.spaceHit();break;case"ArrowUp":e.pressKey("up");break;case"ArrowDown":e.pressKey("down");break;case"ArrowLeft":e.pressKey("left");break;case"ArrowRight":e.pressKey("right");break;default:return}t.preventDefault()}}(e);var r,a,i;t.push((r=document,a="keydown",i=n,r.addEventListener(a,i),()=>r.removeEventListener(a,i)))}(c)}n.d(t,"app",function(){return j})}]);