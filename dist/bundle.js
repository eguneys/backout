var Tetris=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){n(2);const r=n(3);e.exports=r.app},function(e,t,n){},function(e,t,n){"use strict";n.r(t);const r={Play:"play",Over:"over"},a={PaddleRange:13},i=3,o=Math.PI,s=o/3,c=2*o,l=c/3;function h(e,t){return Math.random()*(t-e)+e}function d(e){return e[(t=0,n=e.length,Math.floor(h(t,n)))];var t,n}function f(e,t,n){return Math.min(Math.max(e,t),n)}function u(){return Date.now()}const p=(e,t,n=1e3)=>{u()-e>n&&t()};var g=function(){var e,t,n,r,a,i=function(e){return Math.sin(6.283184*e)},o=function(e){return.003959503758*Math.pow(2,(e-128)/12)},s=function(e,t,n){var r,a,i,s,l,h,d,f=c[e.i[0]],u=e.i[1],p=e.i[3],g=c[e.i[4]],y=e.i[5],v=e.i[8],x=e.i[9],w=e.i[10]*e.i[10]*4,m=e.i[11]*e.i[11]*4,b=e.i[12]*e.i[12]*4,M=1/b,k=e.i[13],T=n*Math.pow(2,2-e.i[14]),S=new Int32Array(w+m+b),C=0,B=0;for(r=0,a=0;r<w+m+b;r++,a++)a>=0&&(a-=T,h=o(t+(15&(k=k>>8|(255&k)<<4))+e.i[2]-128),d=o(t+(15&k)+e.i[6]-128)*(1+8e-4*e.i[7])),i=1,r<w?i=r/w:r>=w+m&&(i-=(r-w-m)*M),s=h,p&&(s*=i*i),l=f(C+=s)*u,s=d,v&&(s*=i*i),l+=g(B+=s)*y,x&&(l+=(2*Math.random()-1)*x),S[r]=80*l*i|0;return S},c=[i,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return t<2?t-1:3-t}];this.init=function(i){e=i,t=i.endPattern,n=0,r=i.rowLen*i.patternLen*(t+1)*2,a=new Int32Array(r)},this.generate=function(){var o,l,h,d,f,u,p,g,y,v,x,w,m,b,M=new Int32Array(r),k=e.songData[n],T=e.rowLen,S=e.patternLen,C=0,B=0,A=!1,P=[];for(h=0;h<=t;++h)for(p=k.p[h],d=0;d<S;++d){var E=p?k.c[p-1].f[d]:0;E&&(k.i[E-1]=k.c[p-1].f[d+S]||0,E<16&&(P=[]));var O=c[k.i[15]],L=k.i[16]/512,D=Math.pow(2,k.i[17]-9)/T,R=k.i[18],U=k.i[19],K=43.23529*k.i[20]*3.141592/44100,j=1-k.i[21]/255,G=1e-5*k.i[22],H=k.i[23]/32,I=k.i[24]/512,_=6.283184*Math.pow(2,k.i[25]-9)/T,F=k.i[26]/255,W=k.i[27]*T&-2;for(x=(h*S+d)*T,f=0;f<4;++f)if(u=p?k.c[p-1].n[d+f*S]:0){P[u]||(P[u]=s(k,u,T));var V=P[u];for(l=0,o=2*x;l<V.length;l++,o+=2)M[o]+=V[l]}for(l=0;l<T;l++)(v=M[g=2*(x+l)])||A?(w=K,R&&(w*=O(D*g)*L+.5),B+=(w=1.5*Math.sin(w))*(m=j*(v-B)-(C+=w*B)),v=3==U?B:1==U?m:C,G&&(v=(v*=G)<1?v>-1?i(.25*v):-1:1,v/=G),A=(v*=H)*v>1e-5,b=v*(1-(y=Math.sin(_*g)*I+.5)),v*=y):b=0,g>=W&&(b+=M[g-W+1]*F,v+=M[g-W]*F),M[g]=0|b,M[g+1]=0|v,a[g]+=0|b,a[g+1]+=0|v}return++n/e.numChannels},this.createWave=function(){var e=44+2*r-8,t=e-36,n=new Uint8Array(44+2*r);n.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var i=0,o=44;i<r;++i){var s=a[i];s=s<-32767?-32767:s>32767?32767:s,n[o++]=255&s,n[o++]=s>>8&255}return n},this.getData=function(e,t){for(var n=2*Math.floor(44100*e),r=new Array(t),i=0;i<2*t;i+=1){var o=n+i;r[i]=e>0&&o<a.length?a[o]/32768:0}return r}},y={songData:[{i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,194,4,1,3,25,191,115,244,147,6,84,6],p:[5,1,2,1,1,1,1,3,4,1,2,1,2,1,2,,,7,8,7,8,7,8,7,8,6,9],c:[{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,48]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,11,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,31]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,123],f:[]},{n:[114,,,,,,,,126,,,,,,,,114,,,,,,,,114,126,111,123,114,126,118,130],f:[13,,,,,,,,,,,,,,,,,,,,,,,,13,,13,,13,,13,11,29,,,,,,,,,,,,,,,,,,,,,,,,32,,41,,29,,25,15]},{n:[123,123,135,128,123,123,135,130,126,125,126,128,123,123,135,128,123,123,135,130,126,125,126,128,123,,99,,,,99,,,,,,,,,,,,,,,,,,,,,,,,,,111],f:[13,11,21,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,17,29,,25,113,,,,,,,,,,,,,,,,,,,,,,,,,,,,194]},{n:[111,,,,,,,,123,,,,,,,,111,,,,,,,,99],f:[]},{n:[111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111,111,123,,123,111,,123,111],f:[]},{n:[114,126,,126,114,,126,114,114,126,,126,114,,126,114,114,126,,126,114,,126,114,116,128,,128,116,,114,121],f:[]},{n:[],f:[]}]},{i:[0,255,117,1,0,255,110,0,1,0,4,6,35,0,0,0,0,0,0,2,14,1,1,39,76,5,0,0],p:[,1,1,1,1,1,1,2,,,,1,1,1,1,1,1,,,1,1,1,1,1,1],c:[{n:[147,,,,,,147,,,,147,,,,,,147,,,,,,147,,,,147,,,,147],f:[]},{n:[147],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,60,4,10,68,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,1,1,2,3,2,3,4,,,,2,3,2,3,2,3,,,5,5,5,5,5,5,4],c:[{n:[,,,,147,,,,,,,,148,,,,,,,,147,,,,,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,147,147,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,68]},{n:[147,,,147,,,147,,147,,,147,,147,,147,147,,,147,,,147,,147,,,147,,147,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]}]},{i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,136,5,1,2,8,92,21,56,148,5,85,8],p:[3,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[111],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,56]}]},{i:[3,0,127,0,3,68,127,0,1,218,4,4,40,0,0,1,55,4,1,2,67,115,124,190,67,6,39,1],p:[,,,1,2,1,2,3,,,,1,2,1,2,1,2,,,1,4,1,4,1,4,3],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,147,147],f:[]},{n:[147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,147],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,67,0,0,0,0,0,0,2,255,15,0,32,83,3,134,4],p:[,,,1,2,3,2,1,2,,,1,2,3,2,1,2,,,,,4,5,4,5],c:[{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],f:[5,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,157,,162,,126],f:[]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],f:[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[159,,162,,164,,,,159,,162,164,,,162,,159,,162,,164,,,,159,,162,164,,,162],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[157,,162,,164,,,,157,,162,164,,,162,,157,,162,,164,,,,157,,162,164,,,162],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]}]},{i:[3,146,140,0,1,224,128,3,0,0,92,0,95,0,0,3,179,5,1,3,37,135,63,67,150,3,157,6],p:[,,,,,,,,,1,2,3,,1,2,1,2,3,,4,5,,,,,3],c:[{n:[123,,,,,,,,,,,,,,,,130],f:[11,24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,92,67]},{n:[133,,,,,,,,,,,,,,,138,126,,,,,,,,,,,,125],f:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,11,,,,95,,,,,,,,,,,,,,,,,,,,,,,,,,,,29]},{n:[123],f:[24,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,52,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,116],f:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,95]},{n:[133,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,126,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,118],f:[]}]},{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,16,83,5,53,1],p:[,,,,,,,1,,,,,,,,,,1,,,,,,,,1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:26,numChannels:8},v={songData:[{i:[0,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,195,4,1,2,50,184,119,244,147,6,84,6],p:[5],c:[{n:[146,146,146,146,146,146,146,146,146,146,146],f:[5]},{n:[146,147],f:[]},{n:[152],f:[]},{n:[152,154,156,154,,147,146,158,142,158,140,156,139,146,140,142,144,146,142,147,142,151,152,152,156,152,154,154,154,154,154,146],f:[]},{n:[152],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},x={songData:[{i:[2,255,152,0,2,255,152,12,0,192,0,29,31,0,0,0,0,0,0,1,255,0,3,32,55,3,124,2],p:[2],c:[{n:[139,139,140,140,140,140,140,139,139,139,139,140,140,140,140,140,139,137,137,137,135,137,137,139,139,139,139,139,140,139,135,137],f:[]},{n:[139],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1};function w(e){let t=new AudioContext,n=t.createGain();n.connect(t.destination);const r={},a=(e,t)=>{r[e]=t},i=[{name:"song",data:y},{name:"sndSplode2",data:v},{name:"sndSplode3",data:x}];this.generate=()=>(i.forEach(e=>{let n=new g;n.init(e.data),function r(){if(1===n.generate()){let r=n.createWave().buffer;t.decodeAudioData(r,t=>{a(e.name,t)})}else setTimeout(r,0)}()}),new Promise(e=>{!function t(){Object.keys(r).length!==i.length?setTimeout(t,100):e()}()})),this.playSound=(e,a=1,i=0,o=.5,s=!1)=>{const c=r[e];if(!c)return null;let l=t.createBufferSource(),h=t.createGain(),d=t.createStereoPanner();return l.buffer=c,l.connect(d),d.connect(h),h.connect(n),l.playbackRate.value=a,l.loop=s,h.gain.value=o,d.pan.value=i,l.start(),{volume:h,sound:l}}}function m(e,t){const{width:n,height:r}=e.game,a=n*r;this.buffers={Screen:0,Effects:a,Buffer:2*a,Background:3*a,Midground:4*a,Foreground:5*a,Sprites:7*a,Ui:8*a,Collision:9*a};const i=this.buffers,o=[4278715910,4279439380,4280620859,4281145203,4280950964,4280499935,4278872826,4280001529,4282504703,4282449151,4284805846,4282637212,4281712985,4281245716,4282284570,4282077732,4280295442,4284757012,4291058728,4292779812,4291286560,4292607142,4294967295,4290835454,4290303738,4288127221,4285754088,4288367292,4286593657,4283642688,4281606692,4279901218,4280822578,4282073457,4282873275,4284720347,4288467700,4293583066,4291934643,4289696651,4287460717,4284634186,4282464563,4281541698,4281872731,4283585166,4285167034,4288919017,4294960867,4294688697,4293172100,4290678104,4286938439,4283328291,4284777522,4287475549,4290436242,4293064653,4289385188,4287344839,4284647072,4283787129,4282666586,4281612610,4278190080];let s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64];this.renderTarget=i.Screen,this.renderSource=i.Page1;const c=t.getImageData(0,0,n,r);let l=new ArrayBuffer(c.data.length),h=new Uint8ClampedArray(l),d=new Uint32Array(l),u=new Uint8ClampedArray(n*r*22);this.clear=e=>{u.fill(e,this.renderTarget,this.renderTarget+a)},this.pset=(e,t,a)=>{e=f(0|e,0,n),t=f(0|t,0,r),u[this.renderTarget+t*n+e]=a},this.pget=(e,t,a)=>(e=f(0|e,0,n),t=f(0|t,0,r),u[a+t*n+e]),this.spr=(e=0,t=0,a=n,i=r,o=0,c=0,l=!1,h=!1)=>{for(let d=0;d<i;d++)for(let i=0;i<a;i++)if(c+d<r&&o+i<n&&c+d>-1&&o+i>-1&&!l&!h){let r=this.renderTarget+((c+d)*n+o+i),a=this.renderSource+((t+d)*n+e+i);u[a]>0&&(u[r]=s[u[a]])}},this.rspr=(e,t,a,i,o,c,l,h)=>{let d=a/2|0,f=i/2|0,p=a/2*1.41421|5,g=i/2*1.41421|5,y=-p,v=p,x=-g,w=g,m=Math.cos(-h),b=Math.sin(-h);for(let l=x;l<w;l++)for(let h=y;h<v;h++){let p=d+Math.round(m*h+b*l),g=f+Math.round(-b*h+m*l),y=h+o|0,v=l+c|0;if(y>0&&y<n&&v>0&&v<r&&p>=0&&g>=0&&p<a&&g<i){let r=this.renderSource+(p+e)+(g+t)*n,a=this.renderTarget+y+v*n;u[r]>0&&(u[a]=s[u[r]])}}},this.line=(e,t,n,r,a)=>{let i,o=(r|=0)-(t|=0),s=(n|=0)-(e|=0),c=1,l=1;if(o<0&&(o=-o,l=-1),s<0&&(s=-s,c=-1),o<<=1,s<<=1,this.pset(e,t,a),s>o)for(i=o-(s>>1);e!=n;)i>=0&&(t+=l,i-=s),e+=c,i+=o,this.pset(e,t,a);else for(i=s-(o>>1);t!=r;)i>=0&&(e+=c,i-=o),t+=l,i+=s,this.pset(e,t,a)},this.circle=(e,t,n,r)=>{let a=-n,i=0,o=2-2*n;do{this.pset(e-a,t+i,r),this.pset(e-i,t-a,r),this.pset(e+a,t-i,r),this.pset(e+i,t+a,r),(n=o)<=i&&(o+=2*++i+1),(n>a||o>i)&&(o+=2*++a+1)}while(a<0)},this.fillCircle=(e,t,n,r)=>{if(n<0)return;e|=0,t|=0,r|=0;let a=-(n|=0),i=0,o=2-2*n;do{this.line(e-a,t-i,e+a,t-i,r),this.line(e-a,t+i,e+a,t+i,r),(n=o)<=i&&(o+=2*++i+1),(n>a||o>i)&&(o+=2*++a+1)}while(a<0)},this.fillRect=(e,t,n,r,a)=>{e|=0,t|=0,n|=0,r|=0;let i=Math.abs(r-t);if(this.line(e,t,n,t,a),i>0)for(;--i;)this.line(e,t+i,n,t+i,a);this.line(e,r,n,r,a)},this.fr=(e,t,n,r,a)=>{let i=0|e,o=0|t,s=e+n|0,c=t+r|0,l=Math.abs(c-o);if(this.line(i,o,s,o,a),l>0)for(;--l;)this.line(i,o+l,s,o+l,a);this.line(i,c,s,c,a)};this.render=()=>{let e=i.Effects;for(;e--;)d[e]=o[s[u[e]]];c.data.set(h),t.putImageData(c,0,0)}}const b=function(){const e={0:"\n.....\n.   .\n. . .\n.   .\n.....\n",1:"\n ..\n. .\n  .\n  .\n....\n",2:"\n ...\n.  .\n  .\n . \n....\n",3:"\n ...\n.  .\n  .\n   .\n....\n",4:"\n   .\n  ..\n . .\n.....\n   .\n   .\n",5:"\n....\n. \n....\n   .\n....\n",6:"\n.....\n.\n.....\n.   .\n.....\n",7:"\n.....\n    .\n    .\n    .\n    .\n",8:"\n.....\n.   .\n.....\n.   .\n.....\n",9:"\n.....\n.   .\n.....\n    .\n.....\n","-":"\n\n\n.....\n\n\n",".":"\n\n\n\n\n .\n"," ":"\n\n\n\n\n\n","/":"\n    .\n   .\n  .\n .\n.\n",a:"\n  .\n . .\n.   .\n.....\n.   .\n",b:"\n....\n.   .\n....\n.   .\n....\n",c:"\n  ...\n.\n.\n.\n ....\n",d:"\n....\n.   .\n.   .\n.   .\n....\n",e:"\n ....\n.\n....\n.\n.....\n",f:"\n ....\n.\n....\n.\n.\n",g:"\n.....\n.\n. ...\n.   .\n.....\n",h:"\n.   .\n.   .\n.....\n.   .\n.   .\n",k:"\n.  .\n. .\n..\n. .\n.  .\n",i:"\n.....\n  .\n  .\n  .\n.....\n",l:"\n.\n.\n.\n.\n.....\n",n:"\n.   .\n..  .\n. . .\n.  ..\n.   .\n",p:"\n....\n.   .\n....\n.\n.\n",r:"\n....\n.   .\n....\n.   .\n.   .\n",s:"\n ...\n.   \n ..\n   .\n...\n",t:"\n.....\n  .\n  .\n  .\n  .\n",u:"\n.   .\n.   .\n.   .\n.   .\n ...\n",v:"\n.   .\n.   .\n.   .\n . .\n  .\n",w:"\n.   .\n.   .\n. . .\n. . .\n . .\n",x:"\n.   .\n . .\n  .\n . .\n.   .\n",y:"\n.   .\n . .\n  .\n  .\n  .\n",unknown:"\n.....\n.   .\n.   .\n.   .\n.....\n"};return Object.keys(e).reduce((t,n)=>({[n]:e[n].replace(/^\n|\n$/g,"").split("\n").map(e=>e.split("")),...t}),{})}();function M(e,t){let n=e.text.length;for(let r=0;r<n;r++){let n=b[e.text.charAt(r)]||b.unknown;for(let a=0;a<5;a++)for(let i=0;i<5;i++)"."===n[a][i]&&(1===e.scale?t.pset(e.x+i+(5+e.hspacing)*r,e.y+a,e.color):t.fr(e.x+i*e.scale+(5*e.scale+e.hspacing)*r,e.y+a*e.scale,e.scale,e.scale,e.color))}}function k(e,t){let n=5*(e={scale:1,hspacing:2,vspacing:2,halign:"center",valign:"center",render:!0,...e}).scale,r=e.text.split("\n"),a=r.slice(0),i=r.length,o=a.sort((e,t)=>t.length-e.length)[0],s=o.length*n+(o.length-1)*e.hspacing,c=i*n+(i-1)*e.vspacing,l=e.x,h=e.y,d=e.x+s,f=e.y+c;"center"===e.halign&&(l=e.x-s/2,d=e.x+s/2),"center"===e.valign&&(h=e.y-c/2,f=e.y+c/2);let u=l+s/2,p=h+c/2;if(e.render)for(let a=0;a<i;a++){let i=r[a],o=i.length*n+(i.length-1)*e.hspacing,s=e.x,l=e.y+(n+e.vspacing)*a;"center"===e.halign&&(s=e.x-o/2),"center"===e.valign&&(l-=c/2),M({x:s,y:l,text:i,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color},t)}return{sx:l,sy:h,cx:u,cy:p,ex:d,ey:f,width:s,height:c}}function T(e,t){const{width:n,height:a}=e.data.game,i=t.buffers,o=e=>{const r=e.data.game.score+"";(e=>{const r=.01*e.data.game.tick,i=.6*n,o=.3*a,s=.008*i,c=n/2-i/2,l=.2*a-o/2;let h=Math.sin(r)*s;t.fr(c+3*s,l+3*s-Math.sin(r)*s,i,o,41),t.fr(c+h,l,i,o,50),k({x:n/2+h,y:.2*a,text:"backout",color:1,scale:5},t)})(e);let i,o=.1*a;i=k({x:n/2,y:.45*a,text:"high score "+r,color:12,scale:3,render:e.data.gameover},t),i=k({x:n/2,y:i.ey+o,text:"press space to play.",color:5,scale:2},t),k({x:n/2,y:i.ey+2*o,text:"avoid paddles to hit the ball.\nuse arrow keys to control paddles.\nuse space to go faster.",vspacing:8,color:7,scale:1.8},t)};this.render=e=>{t.renderTarget=i.Ui,e.data.state===r.Over&&o(e)}}function S(e,t){const{tileWidth:n,tileHeight:r,width:i,height:s}=e.data.game,l=t.buffers;this.render=e=>{(e=e.play).spots.each(e=>(function(e,t,n){n.renderTarget=l.Buffer;const{x:r,y:a,radius:i,color:o}=t.data;n.fillCircle(r,a,i,o),n.fillCircle(r,a,.6*i,o+1)})(0,e,t)),function(e,t){t.renderTarget=l.Background;let a=i/n,o=s/r;for(let e=0;e<a;e++)for(let a=0;a<o;a++){let i,o;i=e*n,o=a*r;let s=t.pget(i,o,l.Buffer);t.fr(i,o,n,r,s)}}(0,t),function(e,t){const n=e.data.hero.edge,r="left"===n?38:41,a="right"===n?38:41,o="up"===n?38:41,c="down"===n?38:41;t.renderTarget=l.Midground,t.fr(0,0,i,1,o),t.fr(0,0,1,s,r),t.fr(0,s-2,i,1,c),t.fr(i-2,0,1,s,a)}(e,t),function(e,t){const{vx:n,vy:r,x:a,y:i,friction:s,active:d}=e.data.hero;if(s>=1||d>0)return;t.renderTarget=l.Midground;const f=(Math.sin(.01*e.data.game.tick)+1)/2*3;const u=Math.atan2(r,n)+o%c,p=Math.cos(u),g=Math.sin(u),y=h(f,f+2),v=h(f+2,f+4),x=h(f+4,f+8);t.fillCircle(a,i,15,20),t.fillCircle(a+p*y,i+g*y,16,21),t.fillCircle(a+p*v,i+g*v,17,22),t.fillCircle(a+p*x,i+g*x,18,0)}(e,t),e.data.paddles.forEach(e=>(function(e,t,n){const{x:r,y:o,w:c,h:h,side:d}=t,{vx:f,vy:u}=t,p=1===f||1===u?12:15;let g=0,y=0,v={side:d};switch(d){case"left":g=.08*h,y=.03*(s/2-o),v.x=r,v.y=o-20,v.w=c+40,v.h=h+40;break;case"right":g=.08*-h,y=.03*(s/2-o),v.x=r-40,v.y=o-20,v.w=c+40,v.h=h+40;break;case"up":y=.08*c,g=.01*(i/2-r),v.x=r-20,v.y=o,v.w=c+40,v.h=h+40;break;case"down":y=.08*-c,g=.01*(i/2-r),v.x=r-20,v.y=o-40,v.w=c+40,v.h=h+40}n.renderTarget=l.Collision,n.fr(v.x,v.y,v.w,v.h,a.PaddleRange),n.renderTarget=l.Midground,n.fr(r+g,o+y,c,h,16),n.fr(r,o,c,h,p)})(0,e,t)),e.blocks.each(e=>(function(e,t){t.renderTarget=l.Collision;const{x:n,y:r,angle:a,length:i,color:o}=e.data;let s=Math.cos(a)*i,c=Math.sin(a)*i;t.line(n,r,n+s,r+c,o)})(e,t)),function(e,t){t.renderTarget=l.Collision;const{vx:n,vy:r,x:a,y:i,radius:o,rotation:s,color:c,active:h,tick:d}=e.data.hero;t.fillCircle(a,i,o,c),t.renderTarget=l.Midground;const f=Math.cos(s),u=Math.sin(s),p=[40,5,4,3,2],g=p[Math.floor(h)%p.length];t.fillCircle(a-.5*n,i-.5*r,o,43),t.fillCircle(a,i,o,g),t.fillCircle(a-f,i-u,.5*o,41)}(e,t),function(e,t){const n=e.data.game.score+"";t.renderTarget=l.Ui;const r=k({x:.1*i,y:10,text:"score",color:48,scale:1},t);k({x:r.ex+20,y:10,text:n,color:48,scale:1},t)}(e,t)}}function C(e,t){const{width:n,height:r}=e.data.game,a=t.buffers;t.renderTarget=a.Screen;const i=new T(e,t),o=new S(e,t);this.render=e=>{!function(e,t){t.renderTarget=a.Ui,t.clear(0),t.renderTarget=a.Collision,t.clear(0),t.renderTarget=a.Background,t.clear(0),t.renderTarget=a.Buffer,t.clear(0),t.renderTarget=a.Screen,t.clear(0),t.renderTarget=a.Midground,t.clear(0),t.renderTarget=a.Foreground,t.clear(0)}(0,t),o.render(e),i.render(e),function(e,t){if(!e.data.debug)return;t.renderTarget=a.Foreground;for(let e=0;e<64;e++){const r=8*Math.floor(e/32)*4+.1*n,a=e%32*8;t.fillRect(r,a,r+8,a+8,e),k({x:r-8,y:a,hspacing:1,text:e+"",color:e},t)}}(e,t),function(e,t){t.renderSource=a.Background,t.renderTarget=a.Screen,t.spr(),t.renderSource=a.Collision,t.renderTarget=a.Screen,t.renderSource=a.Ui,t.renderTarget=a.Screen,t.spr(),t.renderSource=a.Midground,t.renderTarget=a.Screen,t.spr(),t.renderSource=a.Foreground,t.renderTarget=a.Screen,t.spr()}(0,t)}}function B(e,t){this.alive=[],this.dead=[],this.create=n=>{if(this.dead.length>0){let e=this.dead.pop();return e.init(n),this.alive.push(e),e}{let r=new e(t);return r.init(n),this.alive.push(r),r}},this.release=e=>{let t=this.alive.indexOf(e);t>-1&&this.dead.push(this.alive.splice(t,1)[0])},this.each=e=>{this.alive.forEach(e)},this.find=e=>this.alive.find(e)}function A(e,t,n){return n((n,r)=>e.pget(n,r,e.buffers.Collision)===t)}function P({x:e,y:t,w:n,h:r}){return a=>{for(let i=0;i<n;i+=1)for(let n=0;n<r;n+=1){if(a(e+i,t+n))return{x:i,y:n}}return null}}function E(e,{g:t,a:n}){const{width:r,height:i}=e.data.game,o=e.data.hero,{radius:l}=o,h=e=>{A(t,a.PaddleRange,function({x:e,y:t,radius:n}){return r=>{for(let a=0;a<c;a+=s){const i=Math.cos(a)*n,o=Math.sin(a)*n;let s=e+i,c=t+o;if(r(s,c))return{x:s,y:c}}return null}}(o))?d():u()};this.update=t=>{(e=>{const t=o.friction;o.vx+=o.ax*e*.001*o.boost,o.vy+=o.ay*e*.001*o.boost,o.vx*=t,o.vy*=t,o.x+=o.vx,o.y+=o.vy,o.x<l&&(o.x=l,o.vx*=-.5,o.ax*=-1,o.edge="left",o.active=4,o.audioEdge=!0),o.y<l&&(o.y=l,o.vy*=-.5,o.ay*=-1,o.edge="up",o.active=4,o.audioEdge=!0),o.x>=r-l&&(o.x=r-l,o.vx*=-.5,o.ax*=-1,o.edge="right",o.active=4,o.audioEdge=!0),o.y>=i-l&&(o.y=i-l,o.vy*=-.5,o.ay*=-1,o.edge="down",o.active=4,o.audioEdge=!0)})(t),(e=>{o.rotation+=o.active,o.rotation=o.rotation%c})(),h(),(e=>{4===o.active&&(o.audioEdge?(o.audioEdge=!1,n.playSound("sndSplode2")):n.playSound("sndSplode3"))})(),(e=>{o.tick+=e,o.active>0?o.active=Math.max(0,o.active-e/16*.2):delete o.edge})(t),(t=>{e.spots.create({x:o.x-10*o.ax,y:o.y-10*o.ay,color:4,life:2}),e.spots.create({x:o.x-5*o.ax,y:o.y-5*o.ay,color:7,life:2})})(),(t=>{e.data.game.score+=Math.floor(o.active)})()},this.boost=e=>{o.boost=e},this.changeV=e=>{const t=[Math.cos(e),Math.sin(e)],n=[-o.vx,-o.vy],r=[n[0]+t[0],n[1]+t[1]];o.vx=f(2*r[0],-1,1),o.vy=f(2*r[1],-1,1),o.ax=f(2*r[0],-1,1),o.ay=f(2*r[1],-1,1),o.active=4};const d=()=>{o.friction=.9},u=()=>{o.friction=1}}function O(e,t){const{width:n,height:r}=e.data.game,a=e.data.paddles,o=e=>({e:e,c:A(t,i,P(e))});this.update=t=>{(t=>{a.map(o).find(e=>!!e.c)&&e.paddleHit()})(),a.forEach(a=>(t=>a=>{t.x+=t.vx*e.data.paddleBoost[0],t.y+=t.vy*e.data.paddleBoost[1],t.x>n-t.w&&(t.x=n-t.w,t.vx*=-1),t.x<0&&(t.x=0,t.vx*=-1),t.y>r-t.h&&(t.y=r-t.h,t.vy*=-1),t.y<0&&(t.y=0,t.vy*=-1)})(a)(t))}}function L(e){this.init=e=>{this.data={...t(),...e},this.data.radius=2*this.data.life},this.update=t=>{this.data.life-=.01*t,this.data.radius=2*this.data.life,this.data.life<0&&e.spots.release(this)};const t=()=>({x:0,y:0,color:12,life:10})}function D(e,t){const{g:n,a:a}=t;this.data=e;const{width:o,height:s}=this.data.game;this.hero=new E(this,t),this.paddles=new O(this,n),this.blocks=new B(R,this),this.spots=new B(L,this);const l=e=>{const t=this.blocks.find(e=>!(e.life<100)&&A(n,i,function({x:e,y:t,angle:n,length:r}){return a=>{for(let i=0;i<r;i+=.1){const r=Math.cos(n)*i,o=Math.sin(n)*i;let s=e+r,c=t+o;if(a(s,c))return{x:s,y:c}}return null}}(e.data)));t&&f(t)},d=()=>h(2,5),f=e=>{const{x:t,y:n,angle:r,color:a}=e.data;this.hero.changeV(r),this.blocks.release(e),this.spots.create({x:t,y:n,color:a}),h(0,1)<.5&&this.spots.create({x:t+20,y:n,life:d(),color:a}),h(0,1)<.5&&this.spots.create({x:t-20,y:n,life:d(),color:a}),h(0,1)<.5&&this.spots.create({x:t+20,y:n+20,life:d(),color:a}),h(0,1)<.5&&this.spots.create({x:t+20,y:n-20,life:d(),color:a}),h(0,1)<.5&&this.spots.create({x:t,y:n+20,life:d(),color:a}),h(0,1)<.5&&this.spots.create({x:t,y:n-20,life:d(),color:a})},g=()=>{this.userBoost?(this.hero.boost(20),p(this.userBoost,()=>{this.userBoost=0},100)):this.hero.boost(1)},y=K(()=>{const e=this.data.game.unit;this.blocks.create({x:h(e,o-e),y:h(e,s-e),length:.4*e,angle:h(0,c/4-c/8)+c/10})},1e3);this.reset=()=>{this.data.hero.x=o/2,this.data.hero.y=s/2,this.data.game.score=0},this.boost=()=>{this.userBoost=u()},this.paddleHit=()=>{this.data.gameover=u(),this.data.state=r.Over},this.paddleMove=e=>{0!==e[0]&&(this.data.paddleBoost[0]=e[0]),0!==e[1]&&(this.data.paddleBoost[1]=e[1])},this.update=e=>{g(),y(e),l(),this.hero.update(e),this.paddles.update(e),this.blocks.each(t=>t.update(e)),this.spots.each(t=>t.update(e))}}function R(e){this.init=e=>{this.data={...t(),...e},this.life=0},this.update=e=>{this.life+=e};const t=()=>({x:0,y:0,angle:l,length:100,color:U()})}const U=()=>d([18,20,5]),K=(e,t,n)=>{let r=0;return a=>{(r+=a)>=t?(e(),r=0):n&&n(r/t)}};function j(e,t){const{g:n}=t;this.data=e,this.update=e=>{}}function G(e,t){const{g:n,a:a}=t;this.data=e,this.play=new D(e,t),this.over=new j(e,t);const i=e=>{this.data.state===r.Play&&this.play.update(e),this.shouldResetGame&&(this.shouldResetGame=!1,this.play.reset(),this.data.gameover=0,this.data.state=r.Play)},o=e=>{this.data.state===r.Over&&this.over.update(e)};this.spaceHit=()=>{this.data.state===r.Play?this.play.boost():this.data.gameover?p(this.data.gameover,()=>{this.shouldResetGame=!0}):this.shouldResetGame=!0};this.pressKey=e=>{switch(e){case"up":this.play.paddleMove([0,-3]);break;case"down":this.play.paddleMove([0,3]);break;case"left":this.play.paddleMove([-3,0]);break;case"right":this.play.paddleMove([3,0])}},this.releaseKey=e=>{switch(e){case"up":this.data.paddleBoost[1]<0&&this.play.paddleMove([0,1]);break;case"down":this.data.paddleBoost[1]>0&&this.play.paddleMove([0,1]);break;case"left":this.data.paddleBoost[0]<0&&this.play.paddleMove([1,0]);break;case"right":this.data.paddleBoost[0]>0&&this.play.paddleMove([1,0])}},this.update=e=>{i(e),o(e),this.data.game.tick+=e}}const H=void 0!==window.performance?window.performance:Date,I=()=>H.now(),_=window.requestAnimationFrame;function F(e){let t=!1,n=I(),r=0;this.start=()=>t?this:(t=!0,n=I(),r=_(a),this),this.stop=()=>(t=!1,0!=r&&_.cancel(r),r=0,this);const a=()=>{r=_(a);const t=I();e(t-n),n=t}}function W(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function V(e,t){const n=document.createElement("canvas"),a=n.getContext("2d"),o={debug:!1,state:r.Over,game:{score:0,unit:40,tileWidth:3.84,tileHeight:2.56,width:384,height:256,ratio:256/384,vx:10,tick:0},paddleBoost:[1,1],paddles:[{side:"up",vx:1,vy:0,x:192,y:1,w:40,h:10},{side:"down",vx:-1,vy:0,x:192,y:245,w:40,h:10},{side:"left",vx:0,vy:1,x:1,y:128,w:10,h:40},{side:"right",vx:0,vy:-1,x:373,y:128,w:10,h:40}],hero:{color:i,radius:5,gap:2,gapMove:2,rotation:0,x:192,y:128,ax:-1,ay:-1,vx:0,vy:0,rotation:0,boost:1,friction:1,tick:0,active:0}};let s=new w(o);s.generate().then(()=>{s.playSound("song",1,0,.2,!0)});let c=new m(o,a),l=new G(o,{g:c,a:s}),h=new C(l,c);new F(e=>{l.update(e),h.render(l),c.render()}).start(),n.width=o.game.width,n.height=o.game.height,e.append(n),function(e){const t=[],n=function(e){return function(t){switch(t.code){case"Space":e.spaceHit();break;case"ArrowUp":e.pressKey("up");break;case"ArrowDown":e.pressKey("down");break;case"ArrowLeft":e.pressKey("left");break;case"ArrowRight":e.pressKey("right");break;default:return}t.preventDefault()}}(e),r=function(e){return function(t){switch(t.code){case"ArrowUp":e.releaseKey("up");break;case"ArrowDown":e.releaseKey("down");break;case"ArrowLeft":e.releaseKey("left");break;case"ArrowRight":e.releaseKey("right")}}}(e);t.push(W(document,"keydown",n)),t.push(W(document,"keyup",r))}(l)}n.d(t,"app",function(){return V})}]);